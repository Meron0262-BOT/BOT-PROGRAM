from threading import Thread
import discord
from discord.ext import commands
from datetime import datetime, timedelta
from googletrans import Translator

# Botè¨­å®š
intents = discord.Intents.default()
intents.message_content = True
intents.guilds = True
intents.members = True
BOT_OWNER_ID = 1234788478034645015
bot = commands.Bot(command_prefix="me!", intents=intents)

@bot.event
async def on_ready():
    print(f"ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼Botåï¼š{bot.user}")
    if not hasattr(bot, 'synced'):
        try:
            synced = await bot.tree.sync()
            bot.synced = True
            print(f"ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’ {len(synced)} å€‹åŒæœŸã—ã¾ã—ãŸï¼")
        except Exception as e:
            print(e)

# -----------------------------
# Slashã‚³ãƒãƒ³ãƒ‰ï¼ˆBOTä½œæˆè€…é™å®šsayï¼‰
@bot.tree.command(name="say", description="BOTãŒã‚ãªãŸã®ä»£ã‚ã‚Šã«è©±ã—ã¦ãã‚Œã¾ã™ï¼ï¼ˆBOTä½œæˆè€…å°‚ç”¨ï¼‰")
async def say(interaction: discord.Interaction, message: str):
    if interaction.user.id != BOT_OWNER_ID:
        await interaction.response.send_message("ğŸ˜­ ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯BOTä½œæˆè€…å°‚ç”¨ã§ã™ï¼", ephemeral=False)
        return
    await interaction.response.send_message(message)

# -----------------------------
# ã‚­ãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰
@bot.tree.command(name="kick", description="æŒ‡å®šã—ãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’ã‚­ãƒƒã‚¯ã—ã¾ã™ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨ï¼‰")
async def slash_kick(interaction: discord.Interaction, member: discord.Member, reason: str = "ãªã—"):
    if interaction.guild is None:
        await interaction.response.send_message("ğŸ˜­ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼å†…ã§ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ï¼", ephemeral=False)
        return
    if interaction.user.id != interaction.guild.owner_id:
        await interaction.response.send_message("ğŸ˜­ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã—ã‹ä½¿ãˆã¾ã›ã‚“ï¼", ephemeral=False)
        return

    await member.kick(reason=reason)
    await interaction.response.send_message(f"{member.mention} ã‚’ã‚­ãƒƒã‚¯ã—ã¾ã—ãŸï¼ç†ç”±: {reason}")

# -----------------------------
# BANã‚³ãƒãƒ³ãƒ‰
@bot.tree.command(name="ban", description="æŒ‡å®šã—ãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’BANã—ã¾ã™ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨ï¼‰")
async def slash_ban(interaction: discord.Interaction, member: discord.Member, reason: str = "ãªã—"):
    if interaction.guild is None:
        await interaction.response.send_message("ğŸ˜­ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼å†…ã§ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ï¼", ephemeral=True)
        return
    if interaction.user.id != interaction.guild.owner_id:
        await interaction.response.send_message("ğŸ˜­ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã—ã‹ä½¿ãˆã¾ã›ã‚“ï¼", ephemeral=False)
        return
    await member.ban(reason=reason)
    await interaction.response.send_message(f"{member} ã‚’BANã—ã¾ã—ãŸï¼ç†ç”±: {reason}")

# -----------------------------
# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
# --- ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ ---
@bot.tree.command(name="timeout", description="æŒ‡å®šã—ãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã™ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨ï¼‰")
@discord.app_commands.describe(
    member="ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼",
    duration="ä¾‹: 10ç§’, 2åˆ†, 1æ™‚é–“",
    reason="ç†ç”±ï¼ˆä»»æ„ï¼‰"
)
async def timeout_slash(interaction: discord.Interaction, member: discord.Member, duration: str, reason: str = None):
    if interaction.guild is None:
        await interaction.response.send_message("ğŸ˜­ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼å†…ã§ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ï¼", ephemeral=True)
        return
    if interaction.user.id != interaction.guild.owner_id:
        await interaction.response.send_message("ğŸ˜­ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã—ã‹ä½¿ãˆã¾ã›ã‚“ï¼", ephemeral=False)
        return

    unit_multipliers = {'ç§’': 1, 'åˆ†': 60, 'æ™‚é–“': 3600}
    seconds = None
    for unit, multiplier in unit_multipliers.items():
        if duration.endswith(unit):
            try:
                number = int(duration.replace(unit, ''))
                seconds = number * multiplier
                break
            except ValueError:
                await interaction.response.send_message("æ™‚é–“ã®æ•°å€¤ãŒé–“é•ã£ã¦ã„ã¾ã™ï¼")
                return
    if seconds is None:
        await interaction.response.send_message("å˜ä½ã¯ã€Œç§’ã€ã€Œåˆ†ã€ã€Œæ™‚é–“ã€ã®ã©ã‚Œã‹ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼")
        return

    until_time = discord.utils.utcnow() + timedelta(seconds=seconds)
    try:
        await member.timeout(until_time)
        await interaction.response.send_message(f"{member.mention} ã‚’ {duration} ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ç†ç”±: {reason or 'ãªã—'}")
    except discord.Forbidden:
        await interaction.response.send_message("ğŸ˜­ã€€BOTã«æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ï¼")
    except Exception as e:
        await interaction.response.send_message("ğŸ˜­ã€€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸï¼")
        print(e)

# --- ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ ---
@bot.command(name="timeout")
async def timeout_command(ctx, member: discord.Member, duration: str, *, reason: str = "ãªã—"):
    if ctx.author.id != ctx.guild.owner_id:
        await ctx.send("ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã—ã‹ä½¿ãˆã¾ã›ã‚“ï¼")
        return

    unit_multipliers = {'ç§’': 1, 'åˆ†': 60, 'æ™‚é–“': 3600}
    seconds = None
    for unit, multiplier in unit_multipliers.items():
        if duration.endswith(unit):
            try:
                number = int(duration.replace(unit, ''))
                seconds = number * multiplier
                break
            except ValueError:
                await ctx.send("æ™‚é–“ã®æ•°å€¤ãŒé–“é•ã£ã¦ã„ã¾ã™ï¼")
                return
    if seconds is None:
        await ctx.send("å˜ä½ã¯ã€Œç§’ã€ã€Œåˆ†ã€ã€Œæ™‚é–“ã€ã®ã©ã‚Œã‹ã‚’ä½¿ã£ã¦ã­ï¼")
        return

    until_time = discord.utils.utcnow() + timedelta(seconds=seconds)
    try:
        await member.timeout(until_time)
        await ctx.send(f"{member.mention} ã‚’ {duration} ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ç†ç”±: {reason}")
    except discord.Forbidden:
        await ctx.send("ğŸ˜­ã€€BOTã«æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼")
    except Exception as e:
        await ctx.send("ğŸ˜­ã€€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸï¼")
        print(e)

# ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰
@bot.tree.command(name="mention", description="æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—ã¾ã™ï¼ˆä¸Šé™30å›ï¼‰")
async def mentionbomb(interaction: discord.Interaction, member: discord.Member, message: str, count: int):
    
    # ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯@bot.slash_command
    if interaction.user.id != interaction.guild.owner_id:
        await interaction.response.send_message("ğŸ˜­ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã—ã‹ä½¿ãˆã¾ã›ã‚“ï¼", ephemeral=False)
        return

    # ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã®å›æ•°ä¸Šé™ãƒã‚§ãƒƒã‚¯
    if count > 30:
        await interaction.response.send_message("ğŸ˜­ã€€ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã®å›æ•°ã¯æœ€å¤§30å›ã¾ã§ã«ã—ã¦ãã ã•ã„ï¼", ephemeral=False)
        return

    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    mention_text = (f"{member.mention} {message}\n" * count).strip()
    await interaction.response.send_message(mention_text)

translator = Translator()

@bot.tree.command(name="translate", description="è¨€è‘‰ã‚’æŒ‡å®šã—ãŸè¨€èªã«ç¿»è¨³ã—ã¾ã™ï¼")
@discord.app_commands.describe(
    text="ç¿»è¨³ã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆ",
    target_lang="ç¿»è¨³å…ˆã®è¨€èªã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: en, jaï¼‰"
)
async def translate(interaction: discord.Interaction, text: str, target_lang: str):
    try:
        result = await translator.translate(text, dest=dest_lang)
        await interaction.response.send_message(
            f" ç¿»è¨³çµæœï¼ˆ{dest_lang}ï¼‰:\n```{result.text}```"
        )
    except Exception as e:
        print(e)
        await interaction.response.send_message("ğŸ˜­ã€€ç¿»è¨³ã«å¤±æ•—ã—ã¾ã—ãŸï¼")
        
# -----------------------------
# ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
@bot.event
async def on_command_error(ctx, error):
    if isinstance(error, commands.MissingPermissions):
        await ctx.send("ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ï¼")
    elif isinstance(error, commands.MissingRequiredArgument):
        await ctx.send("å¼•æ•°ãŒè¶³ã‚Šã¾ã›ã‚“ï¼")
    else:
        await ctx.send("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼")
        print(error)

# -----------------------------
# èµ·å‹•ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã¯ç’°å¢ƒå¤‰æ•°ãªã©ã§å®‰å…¨ã«ç®¡ç†ã—ã¦ã­ï¼‰
bot.run("MTM2ODkwNjMyOTExNjExNDk3NA.GvwU21.XO_azOMftwkjjrLpHT_Rn6zF_tMLPQ8MGS8WAU")
